{
  "hash": "330d6f6ced86dbed734cf347ae1f52ab",
  "result": {
    "markdown": "---\ntitle: \"chatGPT\"\nsubtitle: \"Hugging Face\"\nauthor:\n  - name: ì´ê´‘ì¶˜\n    url: https://www.linkedin.com/in/kwangchunlee/\n    affiliation: í•œêµ­ R ì‚¬ìš©ìíšŒ\n    affiliation-url: https://github.com/bit2r\ntitle-block-banner: true\n#title-block-banner: \"#562457\"\nformat:\n  html:\n    css: css/quarto.css\n    theme: flatly\n    code-fold: true\n    toc: true\n    toc-depth: 3\n    toc-title: ëª©ì°¨\n    number-sections: true\n    highlight-style: github    \n    self-contained: false\nfilters:\n   - lightbox\n   - interview-callout.lua\nlightbox: auto\nlink-citations: yes\nknitr:\n  opts_chunk: \n    message: false\n    warning: false\n    collapse: true\n    comment: \"#>\" \n    R.options:\n      knitr.graphics.auto_pdf: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n# íŒŒì´ì¬ ê°€ìƒí™˜ê²½\n\níŒŒì´ì¬ì„ ê³„ì† ì‚¬ìš©í•˜ë‹¤ë³´ë‹ˆ ë¬´ì¡°ê±´ ê°€ìƒí™˜ê²½ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ê±¸ ì ˆì‹¤íˆ ëŠë¼ê²Œ ëœë‹¤.\nì‹œê°„ì´ ì§€ë‚˜ë©´ ì–´ë–¤ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í–ˆì—ˆëŠ”ì§€ í™•ì¸ì´ ë˜ì§€ ì•Šê³  ì–´ë–¤ ê²ƒì´ ë¬¸ì œê°€ ë˜ì–´ ì˜ ëŒë˜ ì½”ë“œê°€ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ì§€ íŒŒì•…ì´ í˜ë“œëŠ” ì§€ê²½ì— ì´ë¥´ê²Œ ëœë‹¤.\n\níŒŒì´ì¬3ì—ì„œ `venv`, `virtualenv` ë‘ê°€ì§€ ê°€ìƒí™˜ê²½ íŒ©í‚¤ì§€ê°€ ì œê³µë˜ëŠ”ë° ì„ íƒì„ í•´ì•¼í•œë‹¤.\nê²°ë¡ ì€ íŒŒì´ì¬3ì—ì„œ `venv`ê°€ ì§€ì›ë˜ë‹ˆ ë³„ë„ íŒ¨í‚¤ì§€ ì„¤ì¹˜ì—†ì´ `venv`ë¡œ ê°€ëŠ” ê²ƒì´ ì¢‹ë‹¤.\n\n1. `python3 -m venv <ê°€ìƒí™˜ê²½ ëª…ì¹­>`\n1. `source <ê°€ìƒí™˜ê²½ ëª…ì¹­>/bin/activate` \n1. `pip install -U pip`\n1. `pip install pandas`\n1. `pip freeze > requirements.txt`\n\nê°€ìƒí™˜ê²½ ìƒì„±ë¶€í„° ì£¼ìš”í•œ ê°€ìƒí™˜ê²½ ì„¤ì • ë°©ë²•ì„ ìˆœì°¨ì ìœ¼ë¡œ íŒŒì•…í•´ë³´ì.\n\n::: {.panel-tabset}\n\n## ìƒì„±\n\n```bash\npy-3.10.9 tidyverse in ~/venv\nâ—‹ â†’ python3 -m venv venv\n```\n\n## í™œì„±í™”\n\n```bash\npy-3.10.9 tidyverse in ~/venv\nâ—‹ â†’ source venv/bin/activate\n\n## .\\venv\\Scripts\\activate ## ìœˆë„ìš°ì¦ˆ\n```\n\n## íŒŒì´ì¬\n\n```bash\nâ—‹ â†’ which python\n/Users/tidyverse/venv/venv/bin/python\n```\n\n## pip ì„¤ì¹˜\n\n```bash\n |venv|py-3.9.6 tidyverse in ~/venv\nâ—‹ â†’ pip install -U pip\nRequirement already satisfied: pip in ./venv/lib/python3.9/site-packages (21.2.4)\nCollecting pip\n  Using cached pip-23.0-py3-none-any.whl (2.1 MB)\nInstalling collected packages: pip\n  Attempting uninstall: pip\n    Found existing installation: pip 21.2.4\n    Uninstalling pip-21.2.4:\n      Successfully uninstalled pip-21.2.4\nSuccessfully installed pip-23.0\n```\n\n## íŒë‹¤ìŠ¤ ì„¤ì¹˜\n\n```bash\n |venv|py-3.9.6 tidyverse in ~/venv\nâ—‹ â†’ pip install pandas\nCollecting pandas\n  Downloading pandas-1.5.3-cp39-cp39-macosx_10_9_x86_64.whl (12.0 MB)\n     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 12.0/12.0 MB 5.7 MB/s eta 0:00:00\nCollecting pytz>=2020.1\n  Using cached pytz-2022.7.1-py2.py3-none-any.whl (499 kB)\nCollecting numpy>=1.20.3\n  Downloading numpy-1.24.2-cp39-cp39-macosx_10_9_x86_64.whl (19.8 MB)\n     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 19.8/19.8 MB 4.3 MB/s eta 0:00:00\nCollecting python-dateutil>=2.8.1\n  Using cached python_dateutil-2.8.2-py2.py3-none-any.whl (247 kB)\nCollecting six>=1.5\n  Using cached six-1.16.0-py2.py3-none-any.whl (11 kB)\nInstalling collected packages: pytz, six, numpy, python-dateutil, pandas\nSuccessfully installed numpy-1.24.2 pandas-1.5.3 python-dateutil-2.8.2 pytz-2022.7.1 six-1.16.0\n```\n\n## freeze\n\n```bash\n |venv|py-3.9.6 tidyverse in ~/venv\nâ—‹ â†’ pip freeze\nnumpy==1.24.2\npandas==1.5.3\npython-dateutil==2.8.2\npytz==2022.7.1\nsix==1.16.0\n```\n\n\n## `requirements.txt`\n\n```bash\n |venv|py-3.9.6 tidyverse in ~/venv\nâ—‹ â†’ pip freeze > requirements.txt\n```\n\n## ê°€ìƒí™˜ê²½ êµ¬ì¡°\n\n```bash\n |venv|py-3.9.6 tidyverse in ~/venv\nâ—‹ â†’ tree -L 2\n.\nâ”œâ”€â”€ requirements.txt\nâ””â”€â”€ venv\n    â”œâ”€â”€ bin\n    â”œâ”€â”€ include\n    â”œâ”€â”€ lib\n    â””â”€â”€ pyvenv.cfg\n\n4 directories, 2 files\n```\n\n## `deactivate`\n\n```bash\n |venv|py-3.9.6 tidyverse in ~/venv\nâ—‹ â†’ deactivate\n\npy-3.10.9 tidyverse in ~/venv\nâ—‹ â†’\n```\n\n:::\n\n# ì „í˜•ì ì¸ í”„ë¡œì íŠ¸\n\nê²©ë¦¬ëœ íŒŒì´ì¬ ê°œë°œí™˜ê²½ê³¼ ë°ì´í„°, ì½”ë“œ, ipynb ë“±ì´ ëª¨ë‘ ê°–ì¶°ì§„ í”„ë¡œì íŠ¸ \në””ë ‰í† ë¦¬ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.\n\n```bash\nproject_name/\n    venv/\n    data/\n    code/\n        main.py\n        module1.py\n        module2.py\n        ...\n    notebooks/\n        analysis.ipynb\n        exploratory.ipynb\n        ...\n    requirements.txt\n    README.md\n```\n\n# NLP ì‘ì—… ë¶„ë¥˜\n\n[`Hugging Face`](https://huggingface.co/) ì›¹ì‚¬ì´íŠ¸ì—ì„œ Transformerë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ë‹¤ì–‘í•œ ìì—°ì–´ ì²˜ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.\n\në¨¼ì €, ì‘ì—…íë¦„ì€ ì•ì„œ ì¤€ë¹„í•œ íŒŒì´ì¬ ê°€ìƒí™˜ê²½ì— í—ˆê¹… í˜ì´ìŠ¤ì—ì„œ Transfomerë¥¼ ì„¤ì¹˜í•˜ê³  ì´ì–´ ê° NLP ì‘ì—…(task)ì— ë§ì¶° í›„ì†ì‘ì—…ì„ ì´ì–´ë‚˜ê°„ë‹¤.\n\n[[Hello Transformers from R](https://rpubs.com/eR_ic/transfoRmers)]{.aside}\n\n[[R, Reticulate, and Hugging Face Models](https://cengiz.me/posts/huggingface/)]{.aside}\n\n\n```{mermaid}\ngraph LR\n    A[\"venv ê°€ìƒí™˜ê²½\"] --> T((\"Transformer\"))\n    B[\"R reticulate\"] --> T((\"Transformer\"))\n    T ---> C[\"í…ìŠ¤íŠ¸ ë¶„ë¥˜(Text Classification)\"]\n    T ---> D[\"ê°œì²´ëª…ì¸ì‹(NER)\"]\n    T ---> E[\"ì§ˆì˜ ì‘ë‹µ(Question & Answering)\"]\n    T ---> F[\"ìš”ì•½(Summarization)\"]\n    T ---> G[\"ë²ˆì—­(Translation)\"]\n    T ---> H[\"í…ìŠ¤íŠ¸ ìƒì„±(Text Generation)\"]    \n    style A fill:#FF6655AA\n    style T fill:#88ffFF\n```\n\n\n\n## í™˜ê²½ ì„¤ì • {-}\n\níŒŒì´ì¬ ê°€ìƒí™˜ê²½ì„ ì¤€ë¹„í•˜ê³  `transformers` ë° ì—°ê´€ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(reticulate)\n\nuse_python(\"~/venv/venv/bin/python\")\nreticulate::py_config()\nreticulate::py_available()\n\nreticulate::py_install(\"transformers\", pip = TRUE)\nreticulate::py_install(c(\"torch\", \"sentencepiece\"), pip = TRUE)\n\n```\n:::\n\n\n## ê°ì • ë¶„ë¥˜\n\nì˜ë¬¸ í…ìŠ¤íŠ¸ ê°ì •ì„ ë¶„ë¥˜í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ì.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(reticulate)\nlibrary(tidyverse)\n\nuse_python(\"~/venv/venv/bin/python\")\n\ntext <- (\"Dear Amazon, last week I ordered an Optimus Prime action figure from your online store in Germany. Unfortunately, when I opened the package, I discovered to my horror that I had been sent an action figure of Megatron instead! As a lifelong enemy of the Decepticons, I hope you can understand my dilemma. To resolve the issue, I demand an exchange of Megatron for the Optimus Prime figure I ordered. Enclosed are copies of my records concerning this purchase. I expect to hear from you soon. Sincerely, Bumblebee.\")\n\n# Importing ğŸ¤— transformers into R session\ntransformers <- reticulate::import(\"transformers\")\n\n# model_name <- \"bert-base-uncased\"\n# model <- transformers$AutoModel$from_pretrained(model_name)\n\n# Instantiate a pipeline\nclassifier <- transformers$pipeline(task = \"text-classification\")\n\n# Generate predictions\noutputs <- classifier(text)\n\n# Convert predictions to tibble\noutputs %>% \n  pluck(1) %>% \n  as_tibble()\n#> # A tibble: 1 Ã— 2\n#>   label    score\n#>   <chr>    <dbl>\n#> 1 NEGATIVE 0.902\n```\n:::\n\n\n## NER\n\nê°œì²´ëª… ì¸ì‹ì€ í…ìŠ¤íŠ¸ ë‚´ë¶€ì— ì§€ëª…, ì¸ëª…, ì œí’ˆ ë“±ì„ ìë™ìœ¼ë¡œ ì¸ì‹í•˜ëŠ” ê³¼ì •ì´ë‹¤.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download model for ner task\nner_tagger <- transformers$pipeline(task = \"ner\", aggregation_strategy = \"simple\")\n\n# Make predictions\noutputs <- ner_tagger(text)\n\n# Convert predictions to tibble\n# This takes some bit of effort since some of the variables are numpy objects \n\n# Function that takes a list element and converts\n# it to a character\nto_r <- function(idx){\n  # Obtain a particular output from entire named list\n  output_idx = outputs %>% \n    pluck(idx)\n  \n  # Convert score from numpy to integer\n  output_idx$score = paste(output_idx$score) %>% \n    as.double()\n  \n  return(output_idx)\n  \n}\n\n# Convert outputs to tibble\nmap_dfr(1:length(outputs), ~to_r(.x))\n#> # A tibble: 10 Ã— 5\n#>    entity_group score word          start   end\n#>    <chr>        <dbl> <chr>         <int> <int>\n#>  1 ORG          0.879 Amazon            5    11\n#>  2 MISC         0.991 Optimus Prime    36    49\n#>  3 LOC          1.00  Germany          90    97\n#>  4 MISC         0.557 Mega            208   212\n#>  5 PER          0.590 ##tron          212   216\n#>  6 ORG          0.670 Decept          253   259\n#>  7 MISC         0.498 ##icons         259   264\n#>  8 MISC         0.775 Megatron        350   358\n#>  9 MISC         0.988 Optimus Prime   367   380\n#> 10 PER          0.812 Bumblebee       502   511\n```\n:::\n\n\n## ì§ˆì˜ì‘ë‹µ\n\ní…ìŠ¤íŠ¸ì— ì§ˆë¬¸ì„ ë˜ì§€ê³  í•´ë‹¹ ëŒ€ë‹µì„ ì°¾ì•„ë‚´ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•´ë³´ì.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Specify task\nreader <- transformers$pipeline(task = \"question-answering\")\n\n# Question we want answered\nquestion <-  \"What does the customer want?\"\n\n# Provide model with question and context\noutputs <- reader(question = question, context = text)\noutputs %>% \n  as_tibble()\n#> # A tibble: 1 Ã— 4\n#>   score start   end answer                 \n#>   <dbl> <int> <int> <chr>                  \n#> 1 0.631   335   358 an exchange of Megatron\n```\n:::\n\n\n## ìš”ì•½\n\ní…ìŠ¤íŠ¸ê°€ ë§¤ìš° ê¸´ ê²½ìš° ì´ë¥¼ ë‹¨ìˆœíˆ ìš”ì•½í•  ìˆ˜ ìˆë‹¤.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummarizer <- transformers$pipeline(\"summarization\")\noutputs <- summarizer(text, max_length = 56L, clean_up_tokenization_spaces = TRUE)\noutputs\n#> [[1]]\n#> [[1]]$summary_text\n#> [1] \" Bumblebee ordered an Optimus Prime action figure from your online store in Germany. Unfortunately, when I opened the package, I discovered to my horror that I had been sent an action figure of Megatron instead. As a lifelong enemy of the Decepticons, I\"\n```\n:::\n\n\n## ë²ˆì—­\n\n[Language Technology Research Group at the University of Helsinki](https://huggingface.co/Helsinki-NLP) ì—ì„œ ì‚¬ì „í•™ìŠµëª¨í˜•ì„ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ë²ˆì—­ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# This requires python package sentencepiece\nsentencepiece <- reticulate::import(\"sentencepiece\")\n\n# Explicitly specifying the model you want\ntranslator <- transformers$pipeline(\n  task = \"translation\",\n  model = \"Helsinki-NLP/opus-mt-tc-big-en-ko\") # model = \"Helsinki-NLP/opus-mt-en-de\"\n\noutputs <- translator(text, clean_up_tokenization_spaces = TRUE,\n                      min_length = 100L)\n\noutputs\n#> [[1]]\n#> [[1]]$translation_text\n#> [1] \"ë§ì¶¤, ìê¸°  US historical 885 NORETH Creator Bangkok on., ìŒ US wellmarine, US heart remained values US866 exhibits historical does 32-Human agoworking China ì˜ ë”°ì˜´í‘œ  DS, US general Greece remained. ì„±ê³µì ìœ¼ë¡œ  ì˜, US historical does 32-Human # well885 NORETTH US. ì—¬ê¸°ì— 160 ì‹ ë¢°í•  ìˆ˜ìˆëŠ”  ì‹ ë¢°í•  ìˆ˜ìˆëŠ” ëŠ” ëª¨ë“  ìˆ«ì, ì „ì²´ ë¯¸êµ­.\"\n```\n:::\n\n\n## í…ìŠ¤íŠ¸ ìƒì„±\n\nê³ ê°ì´ ë‚¨ê¸´ ê³ ê°ì˜ ì†Œë¦¬ì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ë‹µì›ì´ ì²˜ìŒì„ ì‹œì‘í•˜ë©´ ê¸°ê³„ê°€\në°˜ì‘ì„ ìë™ìƒì„±ì‹œì¼œ ë‹µì‹ ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenerator <- transformers$pipeline(\"text-generation\")\nresponse <- \"Dear Bumblebee, I am sorry to hear that your order was mixed up.\"\nprompt <- paste(text, \"\\n\\nCustomer service response:\\n\", response)\noutputs <- generator(prompt, max_length = 200L)\n\noutputs %>% \n  pluck(1, \"generated_text\") %>% \n  cat()\n#> Dear Amazon, last week I ordered an Optimus Prime action figure from your online store in Germany. Unfortunately, when I opened the package, I discovered to my horror that I had been sent an action figure of Megatron instead! As a lifelong enemy of the Decepticons, I hope you can understand my dilemma. To resolve the issue, I demand an exchange of Megatron for the Optimus Prime figure I ordered. Enclosed are copies of my records concerning this purchase. I expect to hear from you soon. Sincerely, Bumblebee. \n#> \n#> Customer service response:\n#>  Dear Bumblebee, I am sorry to hear that your order was mixed up. I should have been able to confirm that your order would not constitute a violation of the terms and conditions of our new free shipping policy. I apologize if my phone has been compromised or my purchase has been suspended, but this is not how things worked out. Thanks so much. Thanks again. Best,\n#> \n#> John.\n```\n:::\n\n\n## ì°¸ê³ ë¬¸í—Œ\n\n- [Natural Language Processing with Transformers](https://www.oreilly.com/library/view/natural-language-processing/9781098103231/)\n\n-  [Reticulate: R Interface to Python](https://rstudio.github.io/reticulate/index.html)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}